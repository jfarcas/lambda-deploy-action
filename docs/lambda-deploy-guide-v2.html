<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generic Lambda Deploy Action v1.0.0 - Enterprise Guide</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        h1 {
            color: white;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .version-badge {
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: bold;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-left: 15px;
            border-left: 5px solid #3498db;
            font-size: 1.8em;
        }
        h3 {
            color: #2980b9;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        .yaml-block {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
        }
        .highlight {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 5px solid #f39c12;
        }
        .warning {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 5px solid #dc3545;
        }
        .success {
            background-color: #d1edff;
            border: 1px solid #b8daff;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 5px solid #007bff;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .feature-card h4 {
            color: #2c3e50;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #dee2e6;
        }
        .toc h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .toc ul {
            list-style-type: none;
            padding-left: 0;
        }
        .toc li {
            margin-bottom: 8px;
        }
        .toc a {
            text-decoration: none;
            color: #2980b9;
            padding: 5px 10px;
            display: block;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .toc a:hover {
            background-color: #e3f2fd;
            text-decoration: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px 15px;
            text-align: left;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #2c3e50;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: bold;
            border-radius: 4px;
            margin-right: 5px;
            text-transform: uppercase;
        }
        .badge-required { background-color: #dc3545; color: white; }
        .badge-optional { background-color: #6c757d; color: white; }
        .badge-new { background-color: #28a745; color: white; }
        .badge-improved { background-color: #17a2b8; color: white; }
        .step-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .step-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        .migration-section {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 25px;
            border-radius: 10px;
            margin: 30px 0;
            border: 1px solid #f39c12;
        }
        .changelog-entry {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Generic Lambda Deploy Action</h1>
            <span class="version-badge">v1.0.0 Enterprise Edition</span>
            <p style="margin-top: 15px; font-size: 1.1em;">Production-ready Lambda deployment with comprehensive validation and security</p>
        </div>

        <div class="toc">
            <h3>üìã Table of Contents</h3>
            <ul>
                <li><a href="#overview">üéØ Overview & Features</a></li>
                <li><a href="#whats-new">‚ú® What's New in v1.0.0</a></li>
                <li><a href="#quick-start">üöÄ Quick Start Guide</a></li>
                <li><a href="#configuration">‚öôÔ∏è Configuration Reference</a></li>
                <li><a href="#environments">üåç Environment Setup</a></li>
                <li><a href="#security">üîí Security & Permissions</a></li>
                <li><a href="#migration">üîÑ Future Migration Notes</a></li>
                <li><a href="#troubleshooting">üö® Troubleshooting</a></li>
                <li><a href="#advanced">üîß Advanced Configuration</a></li>
            </ul>
        </div>

        <section id="overview">
            <h2>üéØ Overview & Features</h2>
            
            <p>The Generic Lambda Deploy Action v1.0.0 is an enterprise-grade GitHub Action designed for deploying Lambda functions across multiple repositories with comprehensive validation, security, and monitoring capabilities.</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üîß Enhanced YAML Processing</h4>
                    <p>Proper YAML parsing with validation, error handling, and detailed feedback for configuration issues.</p>
                </div>
                <div class="feature-card">
                    <h4>üõ°Ô∏è Enterprise Security</h4>
                    <p>Input validation, directory traversal protection, comprehensive AWS resource validation, and audit trails.</p>
                </div>
                <div class="feature-card">
                    <h4>‚öôÔ∏è Configurable Runtimes</h4>
                    <p>Support for Bun, Node.js, and Python with configurable versions and custom build commands.</p>
                </div>
                <div class="feature-card">
                    <h4>üîç Deployment Validation</h4>
                    <p>Post-deployment health checks, function state validation, and optional test payload invocation.</p>
                </div>
                <div class="feature-card">
                    <h4>üìä Version Management</h4>
                    <p>Automatic conflict detection, force deployment options, and environment-specific versioning strategies.</p>
                </div>
                <div class="feature-card">
                    <h4>üéØ Organization Agnostic</h4>
                    <p>Fully configurable action references with no hardcoded organization dependencies.</p>
                </div>
            </div>
        </section>

        <section id="whats-new">
            <h2>‚ú® What's New in v1.0.0</h2>
            
            <div class="changelog-entry">
                <h3>üéâ Major Enhancements</h3>
                <ul>
                    <li><span class="badge badge-new">NEW</span> Proper YAML configuration parsing with yq</li>
                    <li><span class="badge badge-new">NEW</span> Comprehensive AWS resource validation</li>
                    <li><span class="badge badge-new">NEW</span> Configurable runtime versions and custom build commands</li>
                    <li><span class="badge badge-new">NEW</span> Post-deployment health checks and validation</li>
                    <li><span class="badge badge-new">NEW</span> Version conflict detection and resolution</li>
                    <li><span class="badge badge-improved">IMPROVED</span> Security with input validation and audit trails</li>
                    <li><span class="badge badge-improved">IMPROVED</span> Error handling with retry logic and detailed messages</li>
                    <li><span class="badge badge-improved">IMPROVED</span> Organization-agnostic design for flexibility</li>
                </ul>
            </div>

            <div class="warning">
                <strong>‚ö†Ô∏è Breaking Changes:</strong> Configuration file structure has been enhanced. See the <a href="#migration">Migration Guide</a> for update instructions.
            </div>
        </section>

        <section id="quick-start">
            <h2>üöÄ Quick Start Guide</h2>
            
            <div class="step-container">
                <h3><span class="step-number">1</span>Deploy to Central Repository</h3>
                <div class="code-block">
# In YourOrg/devops-actions repository
cp lambda-deploy-action.yml .github/actions/lambda-deploy/action.yml
cp lambda-deploy-reusable-workflow.yml .github/workflows/

git add .
git commit -m "feat: add enhanced lambda deploy action v1.0.0"
git tag lambda-deploy/v1.0.0
git push origin main --tags
                </div>
            </div>

            <div class="step-container">
                <h3><span class="step-number">2</span>Configure Lambda Repository</h3>
                <div class="code-block">
# Copy configuration template
cp lambda-deploy-config-example.yml your-lambda-repo/lambda-deploy-config.yml

# Copy workflow template
cp ejemplo-workflow-repositorio.yml your-lambda-repo/.github/workflows/lambda-deploy.yml

# Edit configuration file for your project
# Update action reference to your organization
                </div>
            </div>

            <div class="step-container">
                <h3><span class="step-number">3</span>Setup GitHub Secrets & Variables</h3>
                <table>
                    <tr><th>Type</th><th>Name</th><th>Environment</th><th>Description</th></tr>
                    <tr><td>Secret</td><td>AWS_ACCESS_KEY_ID</td><td>Development</td><td>AWS access key for dev deployments</td></tr>
                    <tr><td>Secret</td><td>AWS_SECRET_ACCESS_KEY</td><td>Development</td><td>AWS secret key for dev deployments</td></tr>
                    <tr><td>Secret</td><td>AWS_ROLE_ARN</td><td>Production</td><td>AWS role ARN for OIDC authentication</td></tr>
                    <tr><td>Variable</td><td>S3_BUCKET_NAME</td><td>All</td><td>S3 bucket for Lambda artifacts</td></tr>
                    <tr><td>Variable</td><td>LAMBDA_FUNCTION_NAME</td><td>All</td><td>Target Lambda function name</td></tr>
                </table>
            </div>
        </section>

        <section id="configuration">
            <h2>‚öôÔ∏è Configuration Reference</h2>
            
            <h3>Basic Configuration Example</h3>
            <div class="yaml-block">
# lambda-deploy-config.yml
project:
  name: "your-lambda-function"
  description: "Lambda function description"
  runtime: "bun"  # Options: bun, node, python
  
  # Optional: Specify runtime versions
  versions:
    bun: "latest"     # Default: latest
    node: "18"        # Default: 18
    python: "3.9"     # Default: 3.9

build:
  # Commands (use "auto" for automatic detection)
  commands:
    install: "auto"   # Custom: "npm ci", "bun install --frozen-lockfile"
    lint: "auto"      # Custom: "eslint src/", "flake8"
    test: "auto"      # Custom: "npm test", "pytest"
    build: "auto"     # Custom: "npm run build", "bun run zip"
  
  # Quality gates
  lint_required: false    # Fail build if linting fails
  tests_required: true    # Fail build if tests fail
  
  # Artifact configuration
  artifact:
    path: "build/lambda.zip"    # Where ZIP is generated
    exclude_patterns:           # Files to exclude
      - "*.md"
      - "tests/"
      - ".env*"

# Deployment configuration
deployment:
  # Optional health check
  health_check:
    test_payload: '{"test": true}'    # Test payload for validation

environments:
  dev:
    trigger_branches: 
      - "main"
      - "feature/MMDSQ**"
    aws:
      region: "eu-west-1"
      auth_type: "access_key"
    deployment:
      versioning: false
      run_tests: true
      notifications: false
  
  prod:
    aws:
      region: "eu-west-1"
      auth_type: "oidc"
    deployment:
      versioning: true
      run_tests: true
      notifications: true
      require_manual_approval: true
    notifications:
      teams:
        webhook_secret: "TEAMS_WEBHOOK_URL"
            </div>

            <h3>Configuration Field Reference</h3>
            <table>
                <tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr>
                <tr><td>project.name</td><td>string</td><td><span class="badge badge-required">Required</span></td><td>Lambda function identifier</td></tr>
                <tr><td>project.runtime</td><td>string</td><td><span class="badge badge-required">Required</span></td><td>Runtime: bun, node, python</td></tr>
                <tr><td>project.versions.*</td><td>string</td><td><span class="badge badge-optional">Optional</span></td><td>Runtime version specifications</td></tr>
                <tr><td>build.commands.*</td><td>string</td><td><span class="badge badge-optional">Optional</span></td><td>Custom build commands or "auto"</td></tr>
                <tr><td>build.*_required</td><td>boolean</td><td><span class="badge badge-optional">Optional</span></td><td>Quality gate enforcement</td></tr>
                <tr><td>deployment.health_check</td><td>object</td><td><span class="badge badge-optional">Optional</span></td><td>Post-deployment validation</td></tr>
                <tr><td>environments.*</td><td>object</td><td><span class="badge badge-required">Required</span></td><td>Environment-specific configuration</td></tr>
            </table>
        </section>

        <section id="environments">
            <h2>üåç Environment Setup</h2>
            
            <h3>Development Environment</h3>
            <div class="success">
                <strong>Characteristics:</strong>
                <ul>
                    <li>Uses AWS Access Keys for authentication</li>
                    <li>Automatic deployment on feature branches and main</li>
                    <li>No versioning - uses timestamp-based deployments</li>
                    <li>Optional testing and linting</li>
                </ul>
            </div>

            <h3>Production Environment</h3>
            <div class="highlight">
                <strong>Characteristics:</strong>
                <ul>
                    <li>Uses OIDC authentication for security</li>
                    <li>Manual deployment through workflow_dispatch</li>
                    <li>Strict versioning with conflict detection</li>
                    <li>Required testing and comprehensive validation</li>
                    <li>Teams notifications for deployment status</li>
                </ul>
            </div>

            <h3>Branch-Based Environment Detection</h3>
            <table>
                <tr><th>Branch Pattern</th><th>Environment</th><th>Trigger</th></tr>
                <tr><td>main</td><td>Development</td><td>Automatic on push</td></tr>
                <tr><td>feature/MMDSQ**</td><td>Development</td><td>Automatic on push</td></tr>
                <tr><td>Any branch</td><td>Pre-production</td><td>Manual workflow_dispatch</td></tr>
                <tr><td>Any branch</td><td>Production</td><td>Manual workflow_dispatch</td></tr>
            </table>
        </section>

        <section id="security">
            <h2>üîí Security & Permissions</h2>
            
            <h3>Required IAM Permissions</h3>
            <div class="yaml-block">
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject", 
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::your-deployment-bucket",
        "arn:aws:s3:::your-deployment-bucket/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "lambda:UpdateFunctionCode",
        "lambda:GetFunction",
        "lambda:PublishVersion",
        "lambda:TagResource",
        "lambda:ListVersionsByFunction",
        "lambda:InvokeFunction"
      ],
      "Resource": "arn:aws:lambda:*:*:function:your-function-name"
    },
    {
      "Effect": "Allow",
      "Action": "sts:GetCallerIdentity",
      "Resource": "*"
    }
  ]
}
            </div>

            <h3>Security Features</h3>
            <ul>
                <li><strong>Input Validation:</strong> Prevents directory traversal and injection attacks</li>
                <li><strong>Resource Validation:</strong> Verifies AWS resources exist before deployment</li>
                <li><strong>Package Size Limits:</strong> Validates against AWS Lambda size constraints</li>
                <li><strong>Audit Trails:</strong> Comprehensive tagging for compliance and tracking</li>
                <li><strong>Secure File Handling:</strong> Configurable exclusion patterns for sensitive files</li>
            </ul>
        </section>

        <section id="migration" class="migration-section">
            <h2>üîÑ Future Migration Notes</h2>
            
            <div class="warning">
                <strong>Important:</strong> When upgrading to future versions, always test in development environment before production deployment.
            </div>

            <h3>Required Changes</h3>
            
            <div class="step-container">
                <h4><span class="step-number">1</span>Update Action References</h4>
                <div class="code-block">
# Current version
action-ref: "YourOrg/devops-actions/.github/actions/lambda-deploy@lambda-deploy/v1.0.0"

# When upgrading to future versions, update the tag accordingly
                </div>
            </div>

            <div class="step-container">
                <h4><span class="step-number">2</span>Enhance Configuration</h4>
                <p>Add these new sections to your <code>lambda-deploy-config.yml</code>:</p>
                <div class="yaml-block">
project:
  # Add runtime versions (optional)
  versions:
    bun: "latest"
    node: "18"
    python: "3.9"

build:
  # Add quality gates (optional)
  lint_required: false
  tests_required: true
  
  # Specify custom commands if needed
  commands:
    install: "auto"
    lint: "auto"
    test: "auto"
    build: "auto"

# Add health checks (optional)
deployment:
  health_check:
    test_payload: '{"test": true}'
                </div>
            </div>

            <div class="step-container">
                <h4><span class="step-number">3</span>Verify Secrets & Variables</h4>
                <p>Ensure all required GitHub secrets and variables are configured as shown in the Quick Start section.</p>
            </div>

            <h3>Backward Compatibility</h3>
            <div class="success">
                <ul>
                    <li>This is the initial v1.0.0 release with full feature set</li>
                    <li>Future versions will maintain backward compatibility where possible</li>
                    <li>Check changelog for any breaking changes in future releases</li>
                </ul>
            </div>
        </section>

        <section id="troubleshooting">
            <h2>üö® Troubleshooting</h2>
            
            <h3>Common Issues & Solutions</h3>
            
            <div class="highlight">
                <h4>YAML Configuration Errors</h4>
                <ul>
                    <li><strong>Symptom:</strong> "Invalid YAML syntax" error</li>
                    <li><strong>Solution:</strong> Validate YAML syntax using online validators</li>
                    <li><strong>Prevention:</strong> Use proper indentation and check for required fields</li>
                </ul>
            </div>

            <div class="highlight">
                <h4>AWS Permission Issues</h4>
                <ul>
                    <li><strong>Symptom:</strong> "Access Denied" errors during deployment</li>
                    <li><strong>Solution:</strong> Verify IAM policies match the required permissions</li>
                    <li><strong>Check:</strong> Ensure resource ARNs are correct and accessible</li>
                </ul>
            </div>

            <div class="highlight">
                <h4>Build Failures</h4>
                <ul>
                    <li><strong>Symptom:</strong> Build step fails with custom commands</li>
                    <li><strong>Solution:</strong> Verify custom build commands are correct</li>
                    <li><strong>Alternative:</strong> Use "auto" for automatic command detection</li>
                </ul>
            </div>

            <div class="highlight">
                <h4>Deployment Validation Failures</h4>
                <ul>
                    <li><strong>Symptom:</strong> Function state validation fails</li>
                    <li><strong>Solution:</strong> Check Lambda function exists and is in correct region</li>
                    <li><strong>Debug:</strong> Review CloudWatch logs for detailed error messages</li>
                </ul>
            </div>

            <h3>Debug Mode</h3>
            <p>Enable detailed logging by setting these environment variables in your workflow:</p>
            <div class="code-block">
env:
  ACTIONS_STEP_DEBUG: true
  ACTIONS_RUNNER_DEBUG: true
            </div>
        </section>

        <section id="advanced">
            <h2>üîß Advanced Configuration</h2>
            
            <h3>Custom Build Commands</h3>
            <div class="yaml-block">
build:
  commands:
    install: "npm ci --production"
    lint: "eslint src/ --format=json --output-file=lint-results.json"
    test: "npm test -- --coverage --reporters=json"
    build: "webpack --mode=production && zip -r lambda.zip dist/"
            </div>

            <h3>Multi-Environment Variables</h3>
            <p>Use GitHub Environment-specific variables for complex setups:</p>
            <div class="yaml-block">
environments:
  prod:
    variables:
      s3_bucket: "S3_BUCKET_NAME_PROD"
      lambda_function: "LAMBDA_FUNCTION_NAME_PROD" 
  dev:
    variables:
      s3_bucket: "S3_BUCKET_NAME_DEV"
      lambda_function: "LAMBDA_FUNCTION_NAME_DEV"
            </div>

            <h3>Health Check Examples</h3>
            <div class="yaml-block">
deployment:
  health_check:
    # Simple ping test
    test_payload: '{"action": "ping"}'
    
    # Or complex validation
    test_payload: '{
      "httpMethod": "GET",
      "path": "/health",
      "headers": {"Content-Type": "application/json"}
    }'
            </div>

            <h3>Performance Optimization</h3>
            <ul>
                <li><strong>Caching:</strong> Use GitHub Actions cache for dependencies</li>
                <li><strong>Parallel Jobs:</strong> Separate build and test jobs for faster execution</li>
                <li><strong>Artifact Exclusions:</strong> Configure exclusion patterns to reduce package size</li>
                <li><strong>Regional Optimization:</strong> Deploy to regions closest to your users</li>
            </ul>
        </section>

        <div style="margin-top: 50px; padding: 20px; background: #f8f9fa; border-radius: 8px; text-align: center;">
            <h3>üìû Enterprise Support</h3>
            <p>This action is designed for production use across enterprise environments with comprehensive error handling, security validation, and audit capabilities.</p>
            <ul style="text-align: left; max-width: 600px; margin: 0 auto;">
                <li><strong>Implementation Support:</strong> Comprehensive documentation and setup guides</li>
                <li><strong>Issue Resolution:</strong> Detailed troubleshooting and error handling</li>
                <li><strong>Security Compliance:</strong> Enterprise-grade security features and audit trails</li>
                <li><strong>Future Migration Assistance:</strong> Smooth transition for future version upgrades</li>
            </ul>
        </div>

        <footer style="margin-top: 40px; text-align: center; color: #6c757d; border-top: 1px solid #dee2e6; padding-top: 20px;">
            <p><strong>Generic Lambda Deploy Action v1.0.0</strong> | Enterprise Edition</p>
            <p>For detailed documentation, see <a href="./README.md">README.md</a> and <a href="./IMPLEMENTATION-GUIDE.md">IMPLEMENTATION-GUIDE.md</a></p>
            <p><em>Last updated: August 21, 2025</em></p>
        </footer>
    </div>
</body>
</html>